!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self)["florence-datacontainer"]=n()}(this,function(){"use strict";var t,n,e,r="undefined"!=typeof Symbol,o="undefined"!=typeof Map,i="undefined"!=typeof Set,s=r?Symbol("immer-nothing"):((t={})["immer-nothing"]=!0,t),a=r?Symbol("immer-draftable"):"__$immer_draftable",u=r?Symbol("immer-state"):"__$immer_state",c=r?Symbol.iterator:"@@iterator",f=function(t,n){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};function l(t,n){function e(){this.constructor=t}f(t,n),t.prototype=(e.prototype=n.prototype,new e)}function h(t){return!!t&&!!t[u]}function d(t){return!!t&&(function(t){if(!t||"object"!=typeof t)return!1;var n=Object.getPrototypeOf(t);return!n||n===Object.prototype}(t)||Array.isArray(t)||!!t[a]||!!t.constructor[a]||b(t)||_(t))}!function(t){t[t.Object=0]="Object",t[t.Array=1]="Array",t[t.Map=2]="Map",t[t.Set=3]="Set"}(n||(n={})),function(t){t[t.ProxyObject=0]="ProxyObject",t[t.ProxyArray=1]="ProxyArray",t[t.ES5Object=2]="ES5Object",t[t.ES5Array=3]="ES5Array",t[t.Map=4]="Map",t[t.Set=5]="Set"}(e||(e={}));var p="undefined"!=typeof Reflect&&Reflect.ownKeys?Reflect.ownKeys:void 0!==Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames;function g(t,e){m(t)===n.Object?p(t).forEach(function(n){return e(n,t[n],t)}):t.forEach(function(n,r){return e(r,n,t)})}function m(t){if(t||C(),t[u])switch(t[u].type){case e.ES5Object:case e.ProxyObject:return n.Object;case e.ES5Array:case e.ProxyArray:return n.Array;case e.Map:return n.Map;case e.Set:return n.Set}return Array.isArray(t)?n.Array:b(t)?n.Map:_(t)?n.Set:n.Object}function y(t,e){return m(t)===n.Map?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function v(t,e){return m(t)===n.Map?t.get(e):t[e]}function w(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}function b(t){return o&&t instanceof Map}function _(t){return i&&t instanceof Set}function E(t){return t.copy||t.base}function O(t,n){if(void 0===n&&(n=!1),Array.isArray(t))return t.slice();var e=Object.create(Object.getPrototypeOf(t));return p(t).forEach(function(r){if(r!==u){var o=Object.getOwnPropertyDescriptor(t,r),i=o.value;if(o.get){if(!n)throw new Error("Immer drafts cannot have computed properties");i=o.get.call(t)}o.enumerable?e[r]=i:Object.defineProperty(e,r,{value:i,writable:!0,configurable:!0})}}),e}function j(t,e){if(d(t)&&!h(t)&&!Object.isFrozen(t)){var r=m(t);r===n.Set?t.add=t.clear=t.delete=S:r===n.Map&&(t.set=t.clear=t.delete=S),Object.freeze(t),e&&g(t,function(t,n){return j(n,!0)})}}function S(){throw new Error("This object has been frozen and should not be mutated")}function C(){throw new Error("Illegal state, please file a bug")}var P=function(){function t(t,n){this.drafts=[],this.parent=t,this.immer=n,this.canAutoFreeze=!0}return t.prototype.usePatches=function(t){t&&(this.patches=[],this.inversePatches=[],this.patchListener=t)},t.prototype.revoke=function(){this.leave(),this.drafts.forEach(k),this.drafts=null},t.prototype.leave=function(){this===t.current&&(t.current=this.parent)},t.enter=function(n){var e=new t(t.current,n);return t.current=e,e},t}();function k(t){var n=t[u];n.type===e.ProxyObject||n.type===e.ProxyArray?n.revoke():n.revoked=!0}function x(t,n,e){var r=e.drafts[0],o=void 0!==n&&n!==r;if(t.willFinalize(e,n,o),o){if(r[u].modified)throw e.revoke(),new Error("An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.");d(n)&&(n=$(t,n,e),e.parent||N(t,n)),e.patches&&(e.patches.push({op:"replace",path:[],value:n}),e.inversePatches.push({op:"replace",path:[],value:r[u].base}))}else n=$(t,r,e,[]);return e.revoke(),e.patches&&e.patchListener(e.patches,e.inversePatches),n!==s?n:void 0}function $(t,n,r,o){var i=n[u];if(!i)return Object.isFrozen(n)?n:M(t,n,r);if(i.scope!==r)return n;if(!i.modified)return N(t,i.base,!0),i.base;if(!i.finalized){if(i.finalized=!0,M(t,i.draft,r,o),t.onDelete&&i.type!==e.Set)if(t.useProxies){g(i.assigned,function(n,e){e||t.onDelete(i,n)})}else{var s=i.base,a=i.copy;g(s,function(n){y(a,n)||t.onDelete(i,n)})}t.onCopy&&t.onCopy(i),t.autoFreeze&&r.canAutoFreeze&&j(i.copy,!1),o&&r.patches&&function(t,n,r,o){switch(t.type){case e.ProxyObject:case e.ES5Object:case e.Map:return function(t,n,e,r){var o=t.base,i=t.copy;g(t.assigned,function(t,s){var a=v(o,t),u=v(i,t),c=s?y(o,t)?"replace":"add":"remove";if(a!==u||"replace"!==c){var f=n.concat(t);e.push("remove"===c?{op:c,path:f}:{op:c,path:f,value:u}),r.push("add"===c?{op:"remove",path:f}:"remove"===c?{op:"add",path:f,value:a}:{op:"replace",path:f,value:a})}})}(t,n,r,o);case e.ES5Array:case e.ProxyArray:return function(t,n,e,r){var o,i,s=t.base,a=t.assigned,u=t.copy;u||C();u.length<s.length&&(s=(o=[u,s])[0],u=o[1],e=(i=[r,e])[0],r=i[1]);var c=u.length-s.length,f=0;for(;s[f]===u[f]&&f<s.length;)++f;var l=s.length;for(;l>f&&s[l-1]===u[l+c-1];)--l;for(var h=f;h<l;++h)if(a[h]&&u[h]!==s[h]){var d=n.concat([h]);e.push({op:"replace",path:d,value:u[h]}),r.push({op:"replace",path:d,value:s[h]})}for(var p=e.length,h=l+c-1;h>=l;--h){var d=n.concat([h]);e[p+h-l]={op:"add",path:d,value:u[h]},r.push({op:"remove",path:d})}}(t,n,r,o);case e.Set:(function(t,n,e,r){var o=t.base,i=t.copy,s=0;o.forEach(function(t){if(!i.has(t)){var o=n.concat([s]);e.push({op:"remove",path:o,value:t}),r.unshift({op:"add",path:o,value:t})}s++}),s=0,i.forEach(function(t){if(!o.has(t)){var i=n.concat([s]);e.push({op:"add",path:i,value:t}),r.unshift({op:"remove",path:i,value:t})}s++})})(t,n,r,o)}}(i,o,r.patches,r.inversePatches)}return i.copy}function M(t,r,o,i){var s=r[u];return s&&(s.type!==e.ES5Object&&s.type!==e.ES5Array||(s.copy=O(s.draft,!0)),r=s.copy),g(r,function(e,a){return function t(e,r,o,i,s,a,u,c){if(u===s)throw Error("Immer forbids circular references");var f=!!i&&s===o;var l=_(s);if(h(u)){var p=c&&f&&!l&&!y(i.assigned,a)?c.concat(a):void 0;u=$(e,u,r,p),function(t,e,r){switch(m(t)){case n.Map:t.set(e,r);break;case n.Set:t.delete(e),t.add(r);break;default:t[e]=r}}(s,a,u),h(u)&&(r.canAutoFreeze=!1)}else{if(f&&w(u,v(i.base,a)))return;d(u)&&(g(u,function(n,s){return t(e,r,o,i,u,n,s,c)}),r.parent||N(e,u))}f&&e.onAssign&&!l&&e.onAssign(i,a,u)}(t,o,r,s,r,e,a,i)}),r}function N(t,n,e){void 0===e&&(e=!1),t.autoFreeze&&!h(n)&&j(n,e)}var A={get:function(t,n){if(n===u)return t;var e=t.drafts;if(!t.modified&&y(e,n))return e[n];var r=E(t)[n];if(t.finalized||!d(r))return r;if(t.modified){if(r!==D(t.base,n))return r;e=t.copy}return e[n]=t.scope.immer.createProxy(r,t)},has:function(t,n){return n in E(t)},ownKeys:function(t){return Reflect.ownKeys(E(t))},set:function(t,n,e){if(!t.modified){var r=D(t.base,n);if(e?w(r,e)||e===t.drafts[n]:w(r,e)&&n in t.base)return!0;F(t),R(t)}return t.assigned[n]=!0,t.copy[n]=e,!0},deleteProperty:function(t,n){return void 0!==D(t.base,n)||n in t.base?(t.assigned[n]=!1,F(t),R(t)):t.assigned[n]&&delete t.assigned[n],t.copy&&delete t.copy[n],!0},getOwnPropertyDescriptor:function(t,n){var r=E(t),o=Reflect.getOwnPropertyDescriptor(r,n);return o&&(o.writable=!0,o.configurable=t.type!==e.ProxyArray||"length"!==n),o},defineProperty:function(){throw new Error("Object.defineProperty() cannot be used on an Immer draft")},getPrototypeOf:function(t){return Object.getPrototypeOf(t.base)},setPrototypeOf:function(){throw new Error("Object.setPrototypeOf() cannot be used on an Immer draft")}},I={};function D(t,n){var e=t[u],r=Reflect.getOwnPropertyDescriptor(e?E(e):t,n);return r&&r.value}function R(t){if(!t.modified){if(t.modified=!0,t.type===e.ProxyObject||t.type===e.ProxyArray){var n=t.copy=O(t.base);g(t.drafts,function(t,e){n[t]=e}),t.drafts=void 0}t.parent&&R(t.parent)}}function F(t){t.copy||(t.copy=O(t.base))}function z(t,n,r){t.drafts.forEach(function(t){t[u].finalizing=!0}),r?h(n)&&n[u].scope===t&&L(t.drafts):(t.patches&&function t(n){if(!n||"object"!=typeof n)return;var r=n[u];if(!r)return;var o=r.base,i=r.draft,s=r.assigned,a=r.type;if(a===e.ES5Object)g(i,function(n){n!==u&&(void 0!==o[n]||y(o,n)?s[n]||t(i[n]):(s[n]=!0,V(r)))}),g(o,function(t){void 0!==i[t]||y(i,t)||(s[t]=!1,V(r))});else if(a===e.ES5Array){if(Q(r)&&(V(r),s.length=!0),i.length<o.length)for(var c=i.length;c<o.length;c++)s[c]=!1;else for(var c=o.length;c<i.length;c++)s[c]=!0;for(var f=Math.min(i.length,o.length),c=0;c<f;c++)void 0===s[c]&&t(i[c])}}(t.drafts[0]),L(t.drafts))}function q(t,n){var r=Array.isArray(t),o=G(t);g(o,function(n){!function(t,n,e){var r=J[n];r?r.enumerable=e:J[n]=r={configurable:!0,enumerable:e,get:function(){return function(t,n){K(t);var e=T(E(t),n);if(t.finalizing)return e;if(e===T(t.base,n)&&d(e))return B(t),t.copy[n]=t.scope.immer.createProxy(e,t);return e}(this[u],n)},set:function(t){!function(t,n,e){if(K(t),t.assigned[n]=!0,!t.modified){if(w(e,T(E(t),n)))return;V(t),B(t)}t.copy[n]=e}(this[u],n,t)}};Object.defineProperty(t,n,r)}(o,n,r||function(t,n){var e=Object.getOwnPropertyDescriptor(t,n);return!(!e||!e.enumerable)}(t,n))});var i,s,a,c={type:r?e.ES5Array:e.ES5Object,scope:n?n.scope:P.current,modified:!1,finalizing:!1,finalized:!1,assigned:{},parent:n,base:t,draft:o,copy:null,revoked:!1,isManual:!1};return i=o,s=u,a=c,Object.defineProperty(i,s,{value:a,enumerable:!1,writable:!0}),o}function T(t,n){var e=t[u];if(e&&!e.finalizing){e.finalizing=!0;var r=t[n];return e.finalizing=!1,r}return t[n]}function V(t){t.modified||(t.modified=!0,t.parent&&V(t.parent))}function B(t){t.copy||(t.copy=G(t.base))}function G(t){var n=t&&t[u];if(n){n.finalizing=!0;var e=O(n.draft,!0);return n.finalizing=!1,e}return O(t)}g(A,function(t,n){I[t]=function(){return arguments[0]=arguments[0][0],n.apply(this,arguments)}}),I.deleteProperty=function(t,n){if(isNaN(parseInt(n)))throw new Error("Immer only supports deleting array indices");return A.deleteProperty.call(this,t[0],n)},I.set=function(t,n,e){if("length"!==n&&isNaN(parseInt(n)))throw new Error("Immer only supports setting array indices and the 'length' property");return A.set.call(this,t[0],n,e,t[0])};var J={};function K(t){if(!0===t.revoked)throw new Error("Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+JSON.stringify(E(t)))}function L(t){for(var n=t.length-1;n>=0;n--){var r=t[n][u];if(!r.modified)switch(r.type){case e.ES5Array:Q(r)&&V(r);break;case e.ES5Object:U(r)&&V(r)}}}function U(t){for(var n=t.base,e=t.draft,r=Object.keys(e),o=r.length-1;o>=0;o--){var i=r[o],s=n[i];if(void 0===s&&!y(n,i))return!0;var a=e[i],c=a&&a[u];if(c?c.base!==s:!w(a,s))return!0}return r.length!==Object.keys(n).length}function Q(t){var n=t.draft;if(n.length!==t.base.length)return!0;var e=Object.getOwnPropertyDescriptor(n,n.length-1);return!(!e||e.get)}var W=function(t){if(!t)throw new Error("Map is not polyfilled");function n(t,n){return this[u]={type:e.Map,parent:n,scope:n?n.scope:P.current,modified:!1,finalized:!1,copy:void 0,assigned:void 0,base:t,draft:this,isManual:!1,revoked:!1},this}l(n,t);var r=n.prototype;return Object.defineProperty(r,"size",{get:function(){return E(this[u]).size},enumerable:!0,configurable:!0}),r.has=function(t){return E(this[u]).has(t)},r.set=function(t,n){var e=this[u];return K(e),E(e).get(t)!==n&&(Z(e),e.scope.immer.markChanged(e),e.assigned.set(t,!0),e.copy.set(t,n),e.assigned.set(t,!0)),this},r.delete=function(t){if(!this.has(t))return!1;var n=this[u];return K(n),Z(n),n.scope.immer.markChanged(n),n.assigned.set(t,!1),n.copy.delete(t),!0},r.clear=function(){var t=this[u];return K(t),Z(t),t.scope.immer.markChanged(t),t.assigned=new Map,t.copy.clear()},r.forEach=function(t,n){var e=this;E(this[u]).forEach(function(r,o,i){t.call(n,e.get(o),o,e)})},r.get=function(t){var n=this[u];K(n);var e=E(n).get(t);if(n.finalized||!d(e))return e;if(e!==n.base.get(t))return e;var r=n.scope.immer.createProxy(e,n);return Z(n),n.copy.set(t,r),r},r.keys=function(){return E(this[u]).keys()},r.values=function(){var t,n=this,e=this.keys();return(t={})[c]=function(){return n.values()},t.next=function(){var t=e.next();return t.done?t:{done:!1,value:n.get(t.value)}},t},r.entries=function(){var t,n=this,e=this.keys();return(t={})[c]=function(){return n.entries()},t.next=function(){var t=e.next();if(t.done)return t;var r=n.get(t.value);return{done:!1,value:[t.value,r]}},t},r[c]=function(){return this.entries()},n}(Map);function Z(t){t.copy||(t.assigned=new Map,t.copy=new Map(t.base))}var Y=function(t){if(!t)throw new Error("Set is not polyfilled");function n(t,n){return this[u]={type:e.Set,parent:n,scope:n?n.scope:P.current,modified:!1,finalized:!1,copy:void 0,base:t,draft:this,drafts:new Map,revoked:!1,isManual:!1},this}l(n,t);var r=n.prototype;return Object.defineProperty(r,"size",{get:function(){return E(this[u]).size},enumerable:!0,configurable:!0}),r.has=function(t){var n=this[u];return K(n),n.copy?!!n.copy.has(t)||!(!n.drafts.has(t)||!n.copy.has(n.drafts.get(t))):n.base.has(t)},r.add=function(t){var n=this[u];return K(n),n.copy?n.copy.add(t):n.base.has(t)||(H(n),n.scope.immer.markChanged(n),n.copy.add(t)),this},r.delete=function(t){if(!this.has(t))return!1;var n=this[u];return K(n),H(n),n.scope.immer.markChanged(n),n.copy.delete(t)||!!n.drafts.has(t)&&n.copy.delete(n.drafts.get(t))},r.clear=function(){var t=this[u];return K(t),H(t),t.scope.immer.markChanged(t),t.copy.clear()},r.values=function(){var t=this[u];return K(t),H(t),t.copy.values()},r.entries=function(){var t=this[u];return K(t),H(t),t.copy.entries()},r.keys=function(){return this.values()},r[c]=function(){return this.values()},r.forEach=function(t,n){for(var e=this.values(),r=e.next();!r.done;)t.call(n,r.value,r.value,this),r=e.next()},n}(Set);function H(t){t.copy||(t.copy=new Set,t.base.forEach(function(n){if(d(n)){var e=t.scope.immer.createProxy(n,t);t.drafts.set(n,e),t.copy.add(e)}else t.copy.add(n)}))}function X(t,e){return e.forEach(function(e){var r=e.path,o=e.op;r.length||C();for(var i=t,s=0;s<r.length-1;s++)if(!(i=v(i,r[s]))||"object"!=typeof i)throw new Error("Cannot apply patch, path doesn't resolve: "+r.join("/"));var a=m(i),u=tt(e.value),c=r[r.length-1];switch(o){case"replace":switch(a){case n.Map:return i.set(c,u);case n.Set:throw new Error('Sets cannot have "replace" patches.');default:return i[c]=u}case"add":switch(a){case n.Array:return i.splice(c,0,u);case n.Map:return i.set(c,u);case n.Set:return i.add(u);default:return i[c]=u}case"remove":switch(a){case n.Array:return i.splice(c,1);case n.Map:return i.delete(c);case n.Set:return i.delete(e.value);default:return delete i[c]}default:throw new Error("Unsupported patch operation: "+o)}}),t}function tt(t){if(!t||"object"!=typeof t)return t;if(Array.isArray(t))return t.map(tt);if(b(t))return new Map(Array.from(t.entries()).map(function(t){return[t[0],tt(t[1])]}));if(_(t))return new Set(Array.from(t).map(tt));var n=Object.create(Object.getPrototypeOf(t));for(var e in t)n[e]=tt(t[e]);return n}function nt(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var i=arguments[n],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}var et={useProxies:"undefined"!=typeof Proxy&&void 0!==Proxy.revocable&&"undefined"!=typeof Reflect,autoFreeze:"undefined"!=typeof process?"production"!==process.env.NODE_ENV:"verifyMinified"===function(){}.name,onAssign:null,onDelete:null,onCopy:null},rt=new(function(){function t(t){var n=this;this.useProxies=!1,this.autoFreeze=!1,g(et,function(e,r){var o,i;n[e]=null!=(i=null===(o=t)||void 0===o?void 0:o[e])?i:r}),this.setUseProxies(this.useProxies),this.produce=this.produce.bind(this),this.produceWithPatches=this.produceWithPatches.bind(this)}return t.prototype.produce=function(t,n,e){var r,o=this;if("function"==typeof t&&"function"!=typeof n){var i=n;n=t;var a=this;return function(t){var e=arguments,r=this;void 0===t&&(t=i);for(var o=[],s=1;s<arguments.length;s++)o[s-1]=e[s];return a.produce(t,function(t){return n.call.apply(n,nt([r,t],o))})}}if("function"!=typeof n)throw new Error("The first or second argument to `produce` must be a function");if(void 0!==e&&"function"!=typeof e)throw new Error("The third argument to `produce` must be a function or undefined");if(d(t)){var u=P.enter(this),c=this.createProxy(t,void 0),f=!0;try{r=n(c),f=!1}finally{f?u.revoke():u.leave()}return"undefined"!=typeof Promise&&r instanceof Promise?r.then(function(t){return u.usePatches(e),x(o,t,u)},function(t){throw u.revoke(),t}):(u.usePatches(e),x(this,r,u))}if((r=n(t))!==s)return void 0===r&&(r=t),N(this,r,!0),r},t.prototype.produceWithPatches=function(t,n,e){var r,o,i=this;return"function"==typeof t?function(n){for(var e=arguments,r=[],o=1;o<arguments.length;o++)r[o-1]=e[o];return i.produceWithPatches(n,function(n){return t.apply(void 0,nt([n],r))})}:(e&&C(),[this.produce(t,n,function(t,n){r=t,o=n}),r,o])},t.prototype.createDraft=function(t){if(!d(t))throw new Error("First argument to `createDraft` must be a plain object, an array, or an immerable object");var n=P.enter(this),e=this.createProxy(t,void 0);return e[u].isManual=!0,n.leave(),e},t.prototype.finishDraft=function(t,n){var e=t&&t[u];if(!e||!e.isManual)throw new Error("First argument to `finishDraft` must be a draft returned by `createDraft`");if(e.finalized)throw new Error("The given draft is already finalized");var r=e.scope;return r.usePatches(n),x(this,void 0,r)},t.prototype.setAutoFreeze=function(t){this.autoFreeze=t},t.prototype.setUseProxies=function(t){this.useProxies=t},t.prototype.applyPatches=function(t,n){var e;for(e=n.length-1;e>=0;e--){var r=n[e];if(0===r.path.length&&"replace"===r.op){t=r.value;break}}return h(t)?X(t,n):this.produce(t,function(t){return X(t,n.slice(e+1))})},t.prototype.createProxy=function(t,n){var r=b(t)?function(t,n){return new W(t,n)}(t,n):_(t)?function(t,n){return new Y(t,n)}(t,n):this.useProxies?function(t,n){var r=Array.isArray(t),o={type:r?e.ProxyArray:e.ProxyObject,scope:n?n.scope:P.current,modified:!1,finalized:!1,assigned:{},parent:n,base:t,draft:null,drafts:{},copy:null,revoke:null,isManual:!1},i=o,s=A;r&&(i=[o],s=I);var a=Proxy.revocable(i,s),u=a.revoke,c=a.proxy;return o.draft=c,o.revoke=u,c}(t,n):q(t,n);return(n?n.scope:P.current).drafts.push(r),r},t.prototype.willFinalize=function(t,n,e){this.useProxies||z(t,n,e)},t.prototype.markChanged=function(t){this.useProxies?R(t):V(t)},t}()),ot=rt.produce;rt.produceWithPatches.bind(rt),rt.setAutoFreeze.bind(rt),rt.setUseProxies.bind(rt),rt.applyPatches.bind(rt),rt.createDraft.bind(rt),rt.finishDraft.bind(rt);function it(t){at(t,{internal:!1})}function st(t){at(t,{internal:!0})}function at(t,{internal:n}){let e=null;const r=n?ft:ut;for(const o in t){r(o);const i=t[o];if(e=e||i.length,!1===n&&0===e)throw new Error("Invalid data: columns cannot be empty");if(e!==i.length)throw new Error("Invalid data: columns must be of same length")}}function ut(t){if(t.match(ct))throw new Error(`Invalid column name '${t}': '$' and '/' are not allowed'`)}const ct=/[\/$]/;function ft(t){["$key","$geometry","$grouped"].includes(t)||ut(t)}function lt(){return new ht}function ht(){this.reset()}ht.prototype={constructor:ht,reset:function(){this.s=this.t=0},add:function(t){pt(dt,t,this.t),pt(this,dt.s,this.s),this.s?this.t+=dt.t:this.s=dt.t},valueOf:function(){return this.s}};var dt=new ht;function pt(t,n,e){var r=t.s=n+e,o=r-n,i=r-o;t.t=n-i+(e-o)}var gt=2*Math.PI,mt=Math.abs,yt=Math.sqrt;function vt(){}function wt(t,n){t&&_t.hasOwnProperty(t.type)&&_t[t.type](t,n)}var bt={Feature:function(t,n){wt(t.geometry,n)},FeatureCollection:function(t,n){for(var e=t.features,r=-1,o=e.length;++r<o;)wt(e[r].geometry,n)}},_t={Sphere:function(t,n){n.sphere()},Point:function(t,n){t=t.coordinates,n.point(t[0],t[1],t[2])},MultiPoint:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)t=e[r],n.point(t[0],t[1],t[2])},LineString:function(t,n){Et(t.coordinates,n,0)},MultiLineString:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)Et(e[r],n,0)},Polygon:function(t,n){Ot(t.coordinates,n)},MultiPolygon:function(t,n){for(var e=t.coordinates,r=-1,o=e.length;++r<o;)Ot(e[r],n)},GeometryCollection:function(t,n){for(var e=t.geometries,r=-1,o=e.length;++r<o;)wt(e[r],n)}};function Et(t,n,e){var r,o=-1,i=t.length-e;for(n.lineStart();++o<i;)r=t[o],n.point(r[0],r[1],r[2]);n.lineEnd()}function Ot(t,n){var e=-1,r=t.length;for(n.polygonStart();++e<r;)Et(t[e],n,1);n.polygonEnd()}function jt(t,n){t&&bt.hasOwnProperty(t.type)?bt[t.type](t,n):wt(t,n)}function St(t){return t}var Ct,Pt,kt,xt,$t=lt(),Mt=lt(),Nt={point:vt,lineStart:vt,lineEnd:vt,polygonStart:function(){Nt.lineStart=At,Nt.lineEnd=Rt},polygonEnd:function(){Nt.lineStart=Nt.lineEnd=Nt.point=vt,$t.add(mt(Mt)),Mt.reset()},result:function(){var t=$t/2;return $t.reset(),t}};function At(){Nt.point=It}function It(t,n){Nt.point=Dt,Ct=kt=t,Pt=xt=n}function Dt(t,n){Mt.add(xt*t-kt*n),kt=t,xt=n}function Rt(){Dt(Ct,Pt)}var Ft=1/0,zt=Ft,qt=-Ft,Tt=qt,Vt={point:function(t,n){t<Ft&&(Ft=t);t>qt&&(qt=t);n<zt&&(zt=n);n>Tt&&(Tt=n)},lineStart:vt,lineEnd:vt,polygonStart:vt,polygonEnd:vt,result:function(){var t=[[Ft,zt],[qt,Tt]];return qt=Tt=-(zt=Ft=1/0),t}};var Bt,Gt,Jt,Kt,Lt=0,Ut=0,Qt=0,Wt=0,Zt=0,Yt=0,Ht=0,Xt=0,tn=0,nn={point:en,lineStart:rn,lineEnd:an,polygonStart:function(){nn.lineStart=un,nn.lineEnd=cn},polygonEnd:function(){nn.point=en,nn.lineStart=rn,nn.lineEnd=an},result:function(){var t=tn?[Ht/tn,Xt/tn]:Yt?[Wt/Yt,Zt/Yt]:Qt?[Lt/Qt,Ut/Qt]:[NaN,NaN];return Lt=Ut=Qt=Wt=Zt=Yt=Ht=Xt=tn=0,t}};function en(t,n){Lt+=t,Ut+=n,++Qt}function rn(){nn.point=on}function on(t,n){nn.point=sn,en(Jt=t,Kt=n)}function sn(t,n){var e=t-Jt,r=n-Kt,o=yt(e*e+r*r);Wt+=o*(Jt+t)/2,Zt+=o*(Kt+n)/2,Yt+=o,en(Jt=t,Kt=n)}function an(){nn.point=en}function un(){nn.point=fn}function cn(){ln(Bt,Gt)}function fn(t,n){nn.point=ln,en(Bt=Jt=t,Gt=Kt=n)}function ln(t,n){var e=t-Jt,r=n-Kt,o=yt(e*e+r*r);Wt+=o*(Jt+t)/2,Zt+=o*(Kt+n)/2,Yt+=o,Ht+=(o=Kt*t-Jt*n)*(Jt+t),Xt+=o*(Kt+n),tn+=3*o,en(Jt=t,Kt=n)}function hn(t){this._context=t}hn.prototype={_radius:4.5,pointRadius:function(t){return this._radius=t,this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._context.closePath(),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._context.moveTo(t,n),this._point=1;break;case 1:this._context.lineTo(t,n);break;default:this._context.moveTo(t+this._radius,n),this._context.arc(t,n,this._radius,0,gt)}},result:vt};var dn,pn,gn,mn,yn,vn=lt(),wn={point:vt,lineStart:function(){wn.point=bn},lineEnd:function(){dn&&_n(pn,gn),wn.point=vt},polygonStart:function(){dn=!0},polygonEnd:function(){dn=null},result:function(){var t=+vn;return vn.reset(),t}};function bn(t,n){wn.point=_n,pn=mn=t,gn=yn=n}function _n(t,n){mn-=t,yn-=n,vn.add(yt(mn*mn+yn*yn)),mn=t,yn=n}function En(){this._string=[]}function On(t){return"m0,"+t+"a"+t+","+t+" 0 1,1 0,"+-2*t+"a"+t+","+t+" 0 1,1 0,"+2*t+"z"}function jn(t){return null==t||t.constructor===Number&&!isFinite(t)}function Sn(t){return void 0!==t}function Cn(t){return void 0===t}En.prototype={_radius:4.5,_circle:On(4.5),pointRadius:function(t){return(t=+t)!==this._radius&&(this._radius=t,this._circle=null),this},polygonStart:function(){this._line=0},polygonEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){0===this._line&&this._string.push("Z"),this._point=NaN},point:function(t,n){switch(this._point){case 0:this._string.push("M",t,",",n),this._point=1;break;case 1:this._string.push("L",t,",",n);break;default:null==this._circle&&(this._circle=On(this._radius)),this._string.push("M",t,",",n,this._circle)}},result:function(){if(this._string.length){var t=this._string.join("");return this._string=[],t}return null}};const Pn=function(t,n){var e,r,o=4.5;function i(t){return t&&("function"==typeof o&&r.pointRadius(+o.apply(this,arguments)),jt(t,e(r))),r.result()}return i.area=function(t){return jt(t,e(Nt)),Nt.result()},i.measure=function(t){return jt(t,e(wn)),wn.result()},i.bounds=function(t){return jt(t,e(Vt)),Vt.result()},i.centroid=function(t){return jt(t,e(nn)),nn.result()},i.projection=function(n){return arguments.length?(e=null==n?(t=null,St):(t=n).stream,i):t},i.context=function(t){return arguments.length?(r=null==t?(n=null,new En):new hn(n=t),"function"!=typeof o&&r.pointRadius(o),i):n},i.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(r.pointRadius(+t),+t),i):o},i.projection(t).context(n)}();function kn(t,n){const e=Pn.bounds(n);return t[0][0]=t[0][0]<e[0][0]?t[0][0]:e[0][0],t[0][1]=t[0][1]<e[0][1]?t[0][1]:e[0][1],t[1][0]=t[1][0]>e[1][0]?t[1][0]:e[1][0],t[1][1]=t[1][1]>e[1][1]?t[1][1]:e[1][1],t}function xn(t){process||console.warn(t),process&&"test"!==process.env.NODE_ENV&&console.warn(t)}function $n(t,n){if("$grouped"===n)throw new Error(`Cannot calculate domain of column '${n}'.`);if(0===t.length)return function(t){if("$geometry"===t)return{x:[],y:[]};if("$geometry"!==t)return[]}(n);const{firstValidValue:e,nValidValues:r}=Mn(t);if(0===r)throw new Error(`Cannot calculate domain of column '${t}'. Column contains only missing values.`);if(r>0){zn(e);const o=Fn(e);if("$geometry"===n)return function(t){let n=[[1/0,1/0],[-1/0,-1/0]];for(let e=0;e<t.length;e++){const r=t[e];jn(r)||(n=kn(n,r))}return{x:[n[0][0],n[1][0]],y:[n[0][1],n[1][1]]}}(t);if("$geometry"!==n)return function(t,n,e,r,o){let i;const s=function(t,n){const e={};if(["quantitative","categorical"].includes(n))for(let n=0;n<t.length;n++){const r=t[n];jn(r)||(e[r]=0)}if("temporal"===n)for(let n=0;n<t.length;n++){const r=t[n];jn(r)||(e[r.getTime()]=0)}if("interval"===n)for(let n=0;n<t.length;n++){const r=t[n];if(!jn(r)){const t=JSON.stringify(r);e[t]=0}}return Object.keys(e).length}(t,o);i=function(t,n){return 1===t||1===n}(e,s)?function(t,n,e,r,o){const i=function(t,n){let e;"quantitative"===t&&(e=[n-1,n+1]);"categorical"===t&&(e=[n]);"temporal"===t&&(e=[Dn(n,-1),Dn(n,1)]);"interval"===t&&(e=n.sort((t,n)=>t-n));return e}(e,r),s=1===t?"valid":"unique";"categorical"!==e&&xn(`Column '${o}' contains only 1 ${s} value: ${r}.\n`+`Using domain ${JSON.stringify(i)}`);return i}(e,0,o,r,n):function(t,n,e){let r=function(t){let n;switch(t){case"quantitative":n=[1/0,-1/0];break;case"categorical":n=[];break;case"temporal":n=[An,Nn];break;case"interval":n=[1/0,-1/0]}return n}(t);for(let o=0;o<n.length;o++){const i=n[o];if(!jn(i)){if(Fn(i)!==t)throw new Error(`Invalid column ${e}: column contains multiple data types`);r=In(r,i,t)}}return r}(o,t,n);return i}(t,n,r,e,o)}}function Mn(t){let n,e=0;for(let r=0;r<t.length&&(jn(t[r])||(e++,n=n||t[r]),!(e>1));r++);return{firstValidValue:n,nValidValues:e}}const Nn=new Date(0),An=new Date("19 January 2038");function In(t,n,e){if(!["quantitative","categorical","temporal","interval"].includes(e))throw new Error(`Cannot set domain for column of type '${e}'`);if("quantitative"===e&&(t[0]>=n&&(t[0]=n),t[1]<=n&&(t[1]=n)),"categorical"===e&&(t.includes(n)||t.push(n)),"temporal"===e){const e=n.getTime();t[0].getTime()>=e&&(t[0]=n),t[1].getTime()<=e&&(t[1]=n)}return"interval"===e&&(t=In(t,n[0],"quantitative"),t=In(t,n[1],"quantitative")),t}function Dn(t,n){const e=new Date(t.getTime());return new Date(e.setDate(e.getDate()+n))}function Rn(t){const{firstValidValue:n}=Mn(t);return Fn(n)}function Fn(t){if(!jn(t))return t.constructor===Number?"quantitative":t.constructor===String?"categorical":t.constructor===Date?"temporal":function(t){return t.constructor===Array&&2===t.length&&t.every(t=>t.constructor===Number)}(t)?"interval":function(t){return t.constructor===Object&&"type"in t&&"coordinates"in t}(t)?"geometry":t.constructor===Ie?"grouped":void 0}function zn(t){if(jn(Fn(t)))throw new Error("Invalid data")}function qn(t,n){if(t.length!==n)throw new Error("Key column must be of same length as rest of the data");!function(t){for(let n=0;n<t.length;n++){const e=t[n];Tn(e)}}(t),function(t){if(t.length!==new Set(t).size)throw new Error("Keys must be unique")}(t)}function Tn(t){if("quantitative"!==Fn(t)||!Number.isInteger(t))throw new Error("Key column can contain only integers")}function Vn(t){return t[Object.keys(t)[0]].length}function Bn(t){!function(t){if(0===t.length)throw new Error("Received empty Array while trying to load row-oriented data. This is not allowed.")}(t);let n=function(t){let n=t[0],e=Object.keys(n),r={};for(let t of e)r[t]=[];return r}(t);for(let e of t)for(let t in e)n[t].push(e[t]);return n}const Gn={_setColumnData(t,n){!1===n.validate?st(t):it(t),this._storeData(t,n)},_setRowData(t,n){const e=Bn(t);this._setColumnData(e,n)},_setGeoJSON(t,n){const e=function(t){const n=[],e={},r=t.features,o=r[0];if("properties"in o)for(const t in o.properties)e[t]=[];for(let t=0;t<r.length;t++){const{geometry:o,properties:i}=r[t];n.push(o);for(const t in i)e[t].push(i[t])}return it(e),e.$geometry=n,e}(t);this._storeData(e,n)},_setGroup(t,n){const e=t.data;st(e),this._storeData(e,n)},_storeData(t,n){this._data=t,this._setupKeyColumn(),!0===n.validate&&this.validateAllColumns()},_setupKeyColumn(){const t=Vn(this._data);if("$key"in this._data)qn(this._data.$key,t),this._syncKeyToRowNumber();else{const n=function(t){return new Array(t).fill(0).map((t,n)=>n)}(t);this._setKeyColumn(n)}},_setKeyColumn(t){this._data=ot(this._data,n=>{n.$key=t}),this._syncKeyToRowNumber()},_syncKeyToRowNumber(){const t=Vn(this._data);for(let n=0;n<t;n++){const t=this._data.$key[n];this._keyToRowNumber[t]=n}}};function Jn(t,n){const e=Vn(t),r={};for(const n in t)r[n]=[];for(let o=0;o<e;o++){const e={};for(const n in t)e[n]=t[n][o];if(!0===n(e,o))for(const t in e)r[t].push(e[t])}return r}const Kn={quantitative:{ascending:(t,n)=>t<n?-1:t>n?1:t>=n?0:NaN,descending:(t,n)=>n<t?-1:n>t?1:n>=t?0:NaN},categorical:{ascending:(t,n)=>{return[t,n].sort()[0]===t?-1:1},descending:(t,n)=>{return[t,n].sort()[0]===t?1:-1}},temporal:{ascending:(t,n)=>t<n?-1:t>n?1:t>=n?0:NaN,descending:(t,n)=>n<t?-1:n>t?1:n>=t?0:NaN}};function Ln(t,n){if(1!==Object.keys(n).length)throw new Error("Only one key-value pair allowed");const e=Object.keys(n)[0],r=n[e];zn(t[e][0]);const o=Fn(t[e][0]);let i;r.constructor===String&&(i=Kn[o][r]),r.constructor===Function&&(i=r);const s=t[e],a=s.map((t,n)=>n).sort((t,n)=>i(s[t],s[n]));for(const n in t)t[n]=Un(t[n],a)}function Un(t,n){return n.map(n=>t[n])}function Qn(t,n){const e=Vn(t),r={};for(const t in n)r[t]=new Array(e);for(let o=0;o<e;o++){const i={};let s={},a={};for(const n in t)i[n]=t[n][o],s[n]=t[n][o-1],a[n]=t[n][o+1];0===o&&(s=void 0),o===e-1&&(a=void 0);for(const t in n){const e=n[t];r[t][o]=e(i,o,s,a)}}Object.assign(t,r)}var Wn={count:Zn,sum:Yn,mean:function(t){return Yn(t)/Zn(t)},median:function(t){const n=t.sort((t,n)=>t>n),e=Zn(t);if(e%2==1)return n[Math.floor(e/2)];{const t=n[e/2-1],r=n[e/2];return(t+r)/2}},mode:function(t){const n={};for(const e of t)e in n?n[e]++:n[e]=1;let e,r=0;for(const t in n)n[t]>r&&(r=n[t],e=t);return e},min:function(t){let n=1/0;for(const e of t)e<n&&(n=e);return n},max:function(t){let n=-1/0;for(const e of t)e>n&&(n=e);return n}};function Zn(t){return t.length}function Yn(t){let n=0;for(const e of t)n+=e;return n}function Hn(t,n){const e=Object.keys(t);if(1!==e.length)throw new Error("Invalid transformation syntax");const r=e[0];if(!n.includes(r))throw new Error(`Unknown transformation ${r}`);return r}function Xn(t,n){const e={};for(const n in t)e[n]=[];if(n&&"$grouped"in n)for(const t in n)"$grouped"!==t&&(e[t]=[]);return e}function te(t,n,e){for(const r in n){const o=n[r];if(o.constructor===Object){const n=Hn(o,Object.keys(t)),i=o[n];if(i.constructor===String){if(!(i in Wn))throw new Error(`Unkown summaryMethod: '${i}'.`);e[r].push(Wn[i](t[n]))}else{if(i.constructor!==Function)throw new Error(`Invalid summaryMethod: '${i}'. Must be String or Function`);e[r].push(i(t[n]))}}}return e}function ne(t,n){for(const e in t){const r=t[e],o=Object.keys(r)[0];if(ut(o),o in n)throw new Error(`Cannot summarise the column '${o}': used for grouping`)}}function ee(t,n,e){for(let r=0;r<e;r++)for(const e in n)t[e].push(n[e][0]);return t}function re(t,n,e){const r=[];for(const o of e)r.push(t[o][n]);return r}class oe{constructor(t,n){this.data={},this.groupedValues=n;for(const n in t)this.data[n]=[]}addRow(t,n){for(const e in t)this.data[e].push(t[e][n])}}var ie=function(t){return t},se=function(t){return!isNaN(parseFloat(t))&&isFinite(t)};function ae(t){this.objectID="",this.separator=" - ",this.legendSeparator=this.separator,this.method="",this.precision=0,this.precisionflag="auto",this.roundlength=2,this.is_uniqueValues=!1,this.debug=!1,this.silent=!1,this.bounds=[],this.ranges=[],this.inner_ranges=null,this.colors=[],this.counter=[],this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null,this.log=function(t,n){!0!==this.debug&&null==n||console.log(this.objectID+"(object id) :: "+t)},this.setBounds=function(t){this.log("Setting bounds ("+t.length+") : "+t.join()),this.bounds=[],this.bounds=t},this.setSerie=function(t){this.log("Setting serie ("+t.length+") : "+t.join()),this.serie=[],this.serie=t,this.resetStatistics(),this.setPrecision()},this.setColors=function(t){this.log("Setting color ramp ("+t.length+") : "+t.join()),this.colors=t},this.doCount=function(){if(!this._nodata()){var t=this.sorted();this.counter=[];for(let t=0;t<this.bounds.length-1;t++)this.counter[t]=0;for(let e=0;e<t.length;e++){var n=this.getClass(t[e]);this.counter[n]++}}},this.setPrecision=function(t){if(void 0!==t&&(this.precisionflag="manual",this.precision=t),"auto"===this.precisionflag)for(var n=0;n<this.serie.length;n++){var e;(e=isNaN(this.serie[n]+"")||-1===(this.serie[n]+"").toString().indexOf(".")?0:(this.serie[n]+"").split(".")[1].length)>this.precision&&(this.precision=e)}this.precision>20&&(this.log("this.precision value ("+this.precision+') is greater than max value. Automatic set-up to 20 to prevent "Uncaught RangeError: toFixed()" when calling decimalFormat() method.'),this.precision=20),this.log("Calling setPrecision(). Mode : "+this.precisionflag+" - Decimals : "+this.precision),this.serie=this.decimalFormat(this.serie)},this.decimalFormat=function(t){for(var n=[],e=0;e<t.length;e++)se(t[e])?n[e]=parseFloat(parseFloat(t[e]).toFixed(this.precision)):n[e]=t[e];return n},this.setRanges=function(){this.ranges=[];for(let t=0;t<this.bounds.length-1;t++)this.ranges[t]=this.bounds[t]+this.separator+this.bounds[t+1]},this.min=function(){if(!this._nodata()){this.stat_min=this.serie[0];for(let t=0;t<this.pop();t++)this.serie[t]<this.stat_min&&(this.stat_min=this.serie[t]);return this.stat_min}},this.max=function(){if(!this._nodata()){this.stat_max=this.serie[0];for(let t=0;t<this.pop();t++)this.serie[t]>this.stat_max&&(this.stat_max=this.serie[t]);return this.stat_max}},this.sum=function(){if(!this._nodata()){if(null===this.stat_sum){this.stat_sum=0;for(let t=0;t<this.pop();t++)this.stat_sum+=parseFloat(this.serie[t])}return this.stat_sum}},this.pop=function(){if(!this._nodata())return null===this.stat_pop&&(this.stat_pop=this.serie.length),this.stat_pop},this.mean=function(){if(!this._nodata())return null===this.stat_mean&&(this.stat_mean=parseFloat(this.sum()/this.pop())),this.stat_mean},this.median=function(){if(!this._nodata()){if(null===this.stat_median){this.stat_median=0;var t=this.sorted();t.length%2?this.stat_median=parseFloat(t[Math.ceil(t.length/2)-1]):this.stat_median=(parseFloat(t[t.length/2-1])+parseFloat(t[t.length/2]))/2}return this.stat_median}},this.variance=function(t){if(t=void 0===t,!this._nodata()){if(null===this.stat_variance){for(var n=0,e=this.mean(),r=0;r<this.pop();r++)n+=Math.pow(this.serie[r]-e,2);this.stat_variance=n/this.pop(),!0===t&&(this.stat_variance=Math.round(this.stat_variance*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))}return this.stat_variance}},this.stddev=function(t){if(t=void 0===t,!this._nodata())return null===this.stat_stddev&&(this.stat_stddev=Math.sqrt(this.variance()),!0===t&&(this.stat_stddev=Math.round(this.stat_stddev*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_stddev},this.cov=function(t){if(t=void 0===t,!this._nodata())return null===this.stat_cov&&(this.stat_cov=this.stddev()/this.mean(),!0===t&&(this.stat_cov=Math.round(this.stat_cov*Math.pow(10,this.roundlength))/Math.pow(10,this.roundlength))),this.stat_cov},this.resetStatistics=function(){this.stat_sorted=null,this.stat_mean=null,this.stat_median=null,this.stat_sum=null,this.stat_max=null,this.stat_min=null,this.stat_pop=null,this.stat_variance=null,this.stat_stddev=null,this.stat_cov=null},this._nodata=function(){if(0===this.serie.length){if(!this.silent)throw new TypeError("Error. You should first enter a serie!");return this.log("[silent mode] Error. You should first enter a serie!",!0),1}return 0},this._nbClassInt=function(t){var n=parseInt(t,10);if(!isNaN(n))return n;if(!this.silent)throw new TypeError("'"+n+"' is not a valid integer. Enable to set class number.");this.log("[silent mode] '"+n+"' is not a valid integer. Enable to set class number.",!0)},this._hasNegativeValue=function(){for(let t=0;t<this.serie.length;t++)if(this.serie[t]<0)return!0;return!1},this._hasZeroValue=function(){for(let t=0;t<this.serie.length;t++)if(0===parseFloat(this.serie[t]))return!0;return!1},this.sorted=function(){return null===this.stat_sorted&&(!1===this.is_uniqueValues?this.stat_sorted=this.serie.sort(function(t,n){return t-n}):this.stat_sorted=this.serie.sort(function(t,n){var e=t.toString().toLowerCase(),r=n.toString().toLowerCase();return e<r?-1:e>r?1:0})),this.stat_sorted},this.setClassManually=function(t){if(!this._nodata()){if(t[0]===this.min()&&t[t.length-1]===this.max())return this.setBounds(t),this.setRanges(),this.method=ie("manual classification")+" ("+(t.length-1)+" "+ie("classes")+")",this.bounds;if(!this.silent)throw new TypeError(ie("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()));this.log("[silent mode] "+ie("Given bounds may not be correct! please check your input.\nMin value : "+this.min()+" / Max value : "+this.max()),!0)}},this.getClassEqInterval=function(t,n,e){if(t=this._nbClassInt(t),!this._nodata()){var r=void 0===n?this.min():n,o=void 0===e?this.max():e,i=[],s=r,a=(o-r)/t;for(let n=0;n<=t;n++)i[n]=s,s+=a;return i[t]=o,this.setBounds(i),this.setRanges(),this.method=ie("eq. intervals")+" ("+t+" "+ie("classes")+")",this.bounds}},this.getQuantiles=function(t){t=this._nbClassInt(t);for(var n=this.sorted(),e=[],r=this.pop()/t,o=1;o<t;o++){var i=Math.round(o*r+.49);e.push(n[i-1])}return e},this.getClassQuantile=function(t){if(t=this._nbClassInt(t),!this._nodata()){var n=this.sorted(),e=this.getQuantiles(t);return e.unshift(n[0]),e[n.length-1]!==n[n.length-1]&&e.push(n[n.length-1]),this.setBounds(e),this.setRanges(),this.method=ie("quantile")+" ("+t+" "+ie("classes")+")",this.bounds}},this.getClassStdDeviation=function(t,n){if(t=this._nbClassInt(t),!this._nodata()){var e=this.max(),r=this.min(),o=this.stddev(),i=this.mean(),s=[];if(t%2==1){var a=Math.floor(t/2),u=a+1;s[a]=i-o/2,s[u]=i+o/2;for(let t=a-1;t>0;t--){let n=s[t+1]-o;s[t]=n}for(let n=u+1;n<t;n++){let t=s[n-1]+o;s[n]=t}}else{var c=t/2;s[c]=i;for(let t=c-1;t>0;t--){let n=s[t+1]-o;s[t]=n}for(let n=c+1;n<t;n++){let t=s[n-1]+o;s[n]=t}}return s[0]=void 0===n?s[1]-o:r,s[t]=void 0===n?s[t-1]+o:e,this.setBounds(s),this.setRanges(),this.method=ie("std deviation")+" ("+t+" "+ie("classes")+")",this.bounds}},this.getClassGeometricProgression=function(t){if(t=this._nbClassInt(t),!this._nodata()){if(!this._hasNegativeValue()&&!this._hasZeroValue()){var n=[],e=this.min(),r=this.max(),o=Math.log(r)/Math.LN10,i=Math.log(e)/Math.LN10,s=(o-i)/t;for(let e=0;e<t;e++)n[e]=0===e?i:n[e-1]+s;return(n=n.map(function(t){return Math.pow(10,t)})).push(this.max()),this.setBounds(n),this.setRanges(),this.method=ie("geometric progression")+" ("+t+" "+ie("classes")+")",this.bounds}if(!this.silent)throw new TypeError(ie("geometric progression can't be applied with a serie containing negative or zero values."));this.log("[silent mode] "+ie("geometric progression can't be applied with a serie containing negative or zero values."),!0)}},this.getClassArithmeticProgression=function(t){if(t=this._nbClassInt(t),!this._nodata()){var n=0;for(let e=1;e<=t;e++)n+=e;var e=[],r=this.min(),o=(this.max()-r)/n;for(let n=0;n<=t;n++)e[n]=0===n?r:e[n-1]+n*o;return this.setBounds(e),this.setRanges(),this.method=ie("arithmetic progression")+" ("+t+" "+ie("classes")+")",this.bounds}},this.getClassJenks=function(t){if(t=this._nbClassInt(t),this._nodata())return;let n=this.sorted();for(var e=[],r=0;r<n.length+1;r++){for(var o=[],i=0,s=t+1;i<s;i++)o.push(0);e.push(o)}for(var a=[],u=0;u<n.length+1;u++){for(var c=[],f=0,l=t+1;f<l;f++)c.push(0);a.push(c)}for(var h=1,d=t+1;h<d;h++){e[0][h]=1,a[0][h]=0;for(var p=1,g=n.length+1;p<g;p++)a[p][h]=1/0;var m=0}for(var y=2,v=n.length+1;y<v;y++){for(var w=0,b=0,_=0,E=1,O=y+1;E<O;E++){var j=y-E+1,S=parseFloat(n[j-1]);m=(b+=S*S)-(w+=S)*w/(_+=1);var C=j-1;if(0!==C)for(var P=2,k=t+1;P<k;P++)a[y][P]>=m+a[C][P-1]&&(e[y][P]=j,a[y][P]=m+a[C][P-1])}e[y][1]=1,a[y][1]=m}var x=n.length,$=[];for(u=0;u<=t;u++)$.push(0);$[t]=parseFloat(n[n.length-1]),$[0]=parseFloat(n[0]);for(var M=t;M>=2;){var N=parseInt(e[x][M]-2);$[M-1]=n[N],x=parseInt(e[x][M]-1),M-=1}return $[0]===$[1]&&($[0]=0),this.setBounds($),this.setRanges(),this.method=ie("Jenks")+" ("+t+" "+ie("classes")+")",this.bounds},this.getClassUniqueValues=function(){if(!this._nodata()){this.is_uniqueValues=!0;var t=this.sorted(),n=[];for(let e=0;e<this.pop();e++)-1===n.indexOf(t[e])&&n.push(t[e]);return this.bounds=n,this.method=ie("unique values"),n}},this.getClass=function(t){for(let n=0;n<this.bounds.length;n++)if(!0===this.is_uniqueValues){if(t===this.bounds[n])return n}else if(parseFloat(t)<=this.bounds[n+1])return n;return ie("Unable to get value's class.")},this.getRanges=function(){return this.ranges},this.getRangeNum=function(t){var n,e;for(e=0;e<this.ranges.length;e++)if(n=this.ranges[e].split(/ - /),t<=parseFloat(n[1]))return e},this.getInnerRanges=function(){if(null!=this.inner_ranges)return this.inner_ranges;var t=[],n=this.sorted(),e=1;for(let r=0;r<n.length;r++){let o;if(0===r&&(o=n[r]),parseFloat(n[r])>parseFloat(this.bounds[e])&&(t[e-1]=""+o+this.separator+n[r-1],o=n[r],e++),e===this.bounds.length-1)return t[e-1]=""+o+this.separator+n[n.length-1],this.inner_ranges=t,this.inner_ranges}},this.getSortedlist=function(){return this.sorted().join(", ")},this.objectID=(new Date).getUTCMilliseconds(),this.log("Creating new geostats object"),void 0!==t&&t.length>0?(this.serie=t,this.setPrecision(),this.log("Setting serie ("+t.length+") : "+t.join())):this.serie=[],this.getJenks=this.getClassJenks,this.getGeometricProgression=this.getClassGeometricProgression,this.getEqInterval=this.getClassEqInterval,this.getQuantile=this.getClassQuantile,this.getStdDeviation=this.getClassStdDeviation,this.getUniqueValues=this.getClassUniqueValues,this.getArithmeticProgression=this.getClassArithmeticProgression}function ue(t,n){const{groupBy:e,method:r,numClasses:o}=function(t){if(t.constructor!==Object)throw new Error("Bin only accepts an Object");const n=t.groupBy;if(n.constructor!==String)throw new Error("groupBy only accepts a String variable name");let e=t.method;e||(xn("No binning method specified, defaulting to EqualInterval"),e="EqualInterval");e.constructor!==String&&(xn("Binning method not recognized, defaulting to EqualInterval"),e="EqualInterval");let r=t.numClasses;r||(xn("numClasses not specified, defaulting to 5"),r=5);return{groupBy:n,method:e,numClasses:r}}(n),i=t[e];if(!i)throw new Error(`groupBy column '${e}' does not exist`);return"IntervalSize"===r?function(t,n){if(!n)throw new Error("Missing required option 'binSize'");const e=$n(t),r=Math.floor((e[1]-e[0])/n);let o=e[0];const i=[o];for(let t=0;t<r-1;t++){const t=o+n;i.push(t),o=t}return i.push(e[1]),i}(i,n.binSize):"Manual"===r?n.manualClasses:new ae(i)[ce[r]](o)}const ce={EqualInterval:"getClassEqInterval",StandardDeviation:"getClassStdDeviation",ArithmeticProgression:"getClassArithmeticProgression",GeometricProgression:"getClassGeometricProgression",Quantile:"getClassQuantile",Jenks:"getClassJenks"};function fe(t){const n=t.length,e=[];for(let r=0;r<n-1;r++)e.push([t[r],t[r+1]]);return e}function le(t,n){return t.findIndex(function(e,r){return r===t.length-1?n>=e[0]&&n<=e[1]:n>=e[0]&&n<e[1]})}function he(t,n,e,r){const o=[];for(let i=0;i<e.length;i++){const s=t[e[i]][n];o.push(le(r[i],s))}return o}function de(t){return t.every(t=>t>-1)}function pe(t,n,e,r){let o=t;for(let t=0;t<n.length;t++){const i=n[t];ge(t,n.length)?(i in o||(o[i]=me(e)),o[i]=ye(o[i],e,r)):(i in o||(o[i]={}),o=o[i])}return t}function ge(t,n){return t===n-1}function me(t){const n={};for(const e in t)n[e]=[];return n}function ye(t,n,e){for(const r in n)t[r].push(n[r][e]);return t}function ve(t){return"bins_"+t}function we(t,n){for(const e of n)if(!(e in t))throw new Error(`Column '${e}' not found`)}function be(t,n){!function t(n,e,r){if(null!==n)for(var o,i,s,a,u,c,f,l,h=0,d=0,p=n.type,g="FeatureCollection"===p,m="Feature"===p,y=g?n.features.length:1,v=0;v<y;v++){u=(l=!!(f=g?n.features[v].geometry:m?n.geometry:n)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var w=0;w<u;w++){var b=0,_=0;if(null!==(a=l?f.geometries[w]:f)){c=a.coordinates;var E=a.type;switch(h=!r||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":if(!1===e(c,d,v,b,_))return!1;d++,b++;break;case"LineString":case"MultiPoint":for(o=0;o<c.length;o++){if(!1===e(c[o],d,v,b,_))return!1;d++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(o=0;o<c.length;o++){for(i=0;i<c[o].length-h;i++){if(!1===e(c[o][i],d,v,b,_))return!1;d++}"MultiLineString"===E&&b++,"Polygon"===E&&_++}"Polygon"===E&&b++;break;case"MultiPolygon":for(o=0;o<c.length;o++){for(_=0,i=0;i<c[o].length;i++){for(s=0;s<c[o][i].length-h;s++){if(!1===e(c[o][i][s],d,v,b,_))return!1;d++}_++}b++}break;case"GeometryCollection":for(o=0;o<a.geometries.length;o++)if(!1===t(a.geometries[o],e,r))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(t,t=>{const e=n(t);t[0]=e[0],t[1]=e[1]})}const _e=new Error("Invalid rowCumsum instrutions");function Ee(t){if(t.constructor!==String&&(t.constructor!==Object||1!==Object.keys(t).length))throw _e}const Oe={filter:Jn,select:ot(function(t,n){if(n.constructor===String&&(n=[n]),n.constructor!==Array)throw new Error("select can only be used with a string or array of strings");!function(t,n){for(const e of n)if(!(e in t))throw new Error(`Column '${e}' not found`)}(t,n);for(const e in t)n.includes(e)||delete t[e]}),arrange:ot(function(t,n){if(n.constructor===Object)Ln(t,n);else{if(n.constructor!==Array)throw new Error("arrange requires a key-value object or array of key-value objects");for(let e=n.length-1;e>=0;e--)Ln(t,n[e])}}),rename:ot(function(t,n){if(n.constructor!==Object)throw new Error("Rename only accepts an object");for(const e in n)if(e in t){const r=n[e];ut(r),t[r]=t[e],delete t[e]}else xn(`Rename: column '${e}' not found`)}),mutate:ot(Qn),transmute:ot(function(t,n){t=Qn(t,n);for(const e in t)e in n||delete t[e]}),summarise:function(t,n){if(n.constructor!==Object)throw new Error("summarise must be an object");let e=Xn(n,t);if("$grouped"in t){ne(n,t);for(const n in t)"$grouped"!==n&&(e[n]=t[n]);for(const r of t.$grouped)e=te(r.data(),n,e)}else e=te(t,n,e);return e},mutarise:function(t,n){if(n.constructor!==Object)throw new Error("mutarise must be an object");let e=Xn(n);if("$grouped"in t){ne(n,t);for(const r of t.$grouped){let t=Xn(n);const o=r.data();e=ee(e,t=te(o,n,t),Vn(o))}t=function(t){const n=Xn(t.$grouped[0].data());for(const e of t.$grouped){const t=e.data();for(const e in n)n[e].push(...t[e])}return n}(t)}else{let r=Xn(n);e=ee(e,r=te(t,n,r),Vn(t))}return function(t,n){for(const e in n)t[e]=n[e];return t}(t,e)},groupBy:function(t,n){const e={},r=function(t,n){const e=n.constructor;if(![String,Array].includes(e))throw new Error("groupBy can only be used with a string or array of strings");const r=e===String?[n]:n;for(const n of r)if(!(n in t))throw new Error(`Column '${n}' not found`);if(r.length===Object.keys(t).length)throw new Error("Cannot group by all columns");return r}(t,n),o=function(t,n){const e={},r=Vn(t);for(let o=0;o<r;o++){const r=re(t,o,n),i=JSON.stringify(r);e[i]=e[i]||new oe(t,r),e[i].addRow(t,o)}return Object.keys(e).map(t=>e[t])}(t,r);e.$grouped=o.map(t=>new Ie(t));for(const t of r)e[t]=[];for(let t=0;t<r.length;t++){const n=r[t];for(const r of o)e[n].push(r.groupedValues[t])}return e},bin:function(t,n){if(n.constructor===Object){const e=fe(ue(t,n));return function(t,n,e){const r=Array(e.length);for(let n=0;n<r.length;n++){r[n]={};for(const e in t)r[n][e]=[]}const o=Vn(t);for(let i=0;i<o;i++){const o=t[n][i],s=le(e,o);if(-1!==s)for(const n in t)r[s][n].push(t[n][i])}const i=function(t){const n=[];for(let e=0;e<t.length;e++)Vn(t[e])>0&&n.push(e);return n}(r),s=i.map(t=>e[t]),a=i.map(t=>r[t]);return{bins:s,$grouped:a.map(t=>new Ie(t,{validate:!1}))}}(t,n.groupBy,e)}if(n.constructor===Array){const e=n.map(n=>ue(t,n)).map(t=>fe(t)),r=n.map(t=>t.groupBy);return function(t,n,e){const r=function(t,n,e){const r=function(t){const n={$grouped:[]};for(let e=0;e<t.length;e++){const r=ve(t[e]);n[r]=[]}return n}(n),o=n.length;return function(t,n){for(const e of function*(t){const n=new Set;yield*function*t(e,r=[]){if(!n.has(e)){n.add(e);for(const n of Object.keys(e)){const o=r.concat(n);"$key"in e[n]?(o.push(e[n]),yield o):yield*t(e[n],o)}}}(t)}(t))n(e)}(t,t=>{for(let o=0;o<n.length;o++){const i=t[o],s=e[o][i],a=ve(n[o]);r[a].push(s)}r.$grouped.push(t[o])}),r}(function(t,n,e){let r={};const o=Vn(t);for(let i=0;i<o;i++){const o=he(t,i,n,e);de(o)&&(r=pe(r,o,t,i))}return r}(t,n,e),n,e);return r.$grouped=r.$grouped.map(t=>new Ie(t,{validate:!1})),r}(t,r,e)}},dropNA:function(t,n){let e;if(n)if(n.constructor===String)we(t,[n]),e=(t=>!jn(t[n]));else{if(n.constructor!==Array)throw new Error("dropNA can only be passed undefined, a String or an Array of Strings");we(t,n),e=(t=>{let e=!0;for(const r of n)if(jn(t[r])){e=!1;break}return e})}else e=(t=>{let n=!0;for(const e in t)if(jn(t[e])){n=!1;break}return n});return Jn(t,e)},reproject:ot(function(t,n){if(!("$geometry"in t))return xn("No geometry column found. Skipping reproject-transformation."),t;const e=function(t,n){const e=JSON.parse(JSON.stringify(t));if(e.constructor===Array)for(let t=0;t<e.length;t++)be(e[t],n);if(e.constructor===Object)for(const t in e)be(e[t],n);return e}(t.$geometry,n);return t.$geometry=e,t}),transform:ot(function(t,n){if(n.constructor!==Function)throw new Error("Invalid 'transform' transformation: must be a Function");n(t)}),cumsum:ot(function(t,n,e={asInterval:!1}){const r=e.asInterval,o=Vn(t),i={};for(const e in n){ut(e);const s=n[e];if("quantitative"!==Rn(t[s]))throw new Error("cumsum columns can only be of type 'quantitative'");let a=0,u=0;i[e]=[];for(let n=0;n<o;n++){const o=t[s][n];jn(o)||(u+=o),r?i[e].push([a,u]):i[e].push(u),a=u}}Object.assign(t,i)}),rowCumsum:ot(function(t,n,e={asInterval:!1}){const r=e.asInterval,o=function(t){if(t&&t.constructor===Array){const n=[];for(const e of t)if(Ee(e),e.constructor===String&&n.push([e,e]),e.constructor===Object){const t=Object.keys(e)[0],r=e[t];n.push([t,r])}return n}throw _e}(n);!function(t,n){for(const[,e]of n){const n=t[e];if(!n)throw new Error(`Column '${e}' does not exist`);const r=Rn(n);if("quantitative"!==r)throw new Error("rowCumsum columns can only be of type 'quantitative'")}}(t,o);const i={};let s;for(const[n,e]of o){ut(n);const o=t[e];if(void 0===s)i[n]=r?o.map(t=>[0,t]):o;else{const t=i[s];let e;e=r?o.map((n,e)=>{const r=t[e][1];return[r,r+n]}):o.map((n,e)=>n+t[e]),i[n]=e}s=n}Object.assign(t,i)})},je={arrange(t){const n=Oe.arrange(this._data,t);return new Ie(n,{validate:!1})},bin(t){const n=Oe.bin(this._data,t);return new Ie(n,{validate:!1})},cumsum(t,n){const e=Oe.cumsum(this._data,t,n);return new Ie(e,{validate:!1})},dropNA(t){const n=Oe.dropNA(this._data,t);return new Ie(n,{validate:!1})},filter(t){const n=Oe.filter(this._data,t);return new Ie(n,{validate:!1})},groupBy(t){const n=Oe.groupBy(this._data,t);return new Ie(n,{validate:!1})},mutarise(t){const n=Oe.mutarise(this._data,t);return new Ie(n,{validate:!1})},mutarize(t){const n=Oe.mutarise(this._data,t);return new Ie(n,{validate:!1})},mutate(t){const n=Oe.mutate(this._data,t);return new Ie(n,{validate:!1})},transmute(t){const n=Oe.transmute(this._data,t);return new Ie(n,{validate:!1})},rename(t){const n=Oe.rename(this._data,t);return new Ie(n,{validate:!1})},reproject(t){const n=Oe.reproject(this._data,t);return new Ie(n,{validate:!1})},rowCumsum(t,n){const e=Oe.rowCumsum(this._data,t,n);return new Ie(e,{validate:!1})},select(t){const n=Oe.select(this._data,t);return new Ie(n,{validate:!1})},summarise(t){const n=Oe.summarise(this._data,t);return new Ie(n,{validate:!1})},summarize(t){const n=Oe.summarise(this._data,t);return new Ie(n,{validate:!1})},transform(t){const n=Oe.transform(this._data,t);return new Ie(n,{validate:!1})}};function Se(t,n){if(Cn(n._keyToRowNumber[t]))throw new Error(`Key '${t}' not found`)}function Ce(t,n,e){if(!jn(t)){const r=Rn(e._data[n]);zn(t);const o=Fn(t);if(r!==o)throw new Error(`Column '${n}' is of type '${r}'. Received value of type '${o}'`)}}function Pe(t,n){const{nValidValues:e}=Mn(t);if(0===e)throw new Error(`Invalid column '${n}'. Column contains only invalid values.`);const r=Rn(t);if(void 0===r)throw new Error(`Column '${n}' contains data of unknown type`);!function(t,n){if("$geometry"===t&&"geometry"!==n)throw new Error(`Column '$geometry' can only contain data of type 'geometry', received '${n}'`);if("$geometry"!==t&&"geometry"===n)throw new Error("Only the '$geometry' column can contain data of type 'geometry'")}(r),function(t,n,e){if(!ke(t,n))throw new Error(`Column '${e}' mixes types`)}(t,r,n)}function ke(t,n){for(let e=0;e<t.length;e++){const r=t[e];if(!jn(r)&&Fn(r)!==n)return!1}return!0}function xe(t,n){return t in n._data}function $e(t,n){if(!xe(t,n))throw new Error(`Invalid column name: '${t}'`)}const Me={addRow(t){!function(t,n){for(const e in t)if(!(e in n._data))throw new Error(`Column '${e}' not found`);for(const e in n._data)if("$key"===e){if(e in t)throw new Error("Cannot set '$key' column")}else{if(!(e in t))throw new Error(`Missing column '${e}'`);Ce(t[e],e,n)}}(t,this);const n=this;this._data=ot(this._data,e=>{for(const r in t){const o=t[r];e[r].push(o),n._updateDomainIfNecessary(r,o)}});const e=Vn(this._data)-1,r=this.domain("$key");r[1]++;const o=r[1];this._data=ot(this._data,t=>{t.$key.push(o)}),this._keyToRowNumber[o]=e},updateRow(t,n){if(n.constructor===Function){const e=n(this.row(t));if(!e||e.constructor!==Object)throw new Error("updateRow function must return Object");this.updateRow(t,e)}Se(t,this),function(t,n){for(const e in t){if(!(e in n._data))throw new Error(`Column '${e}' not found`);Ce(t[e],e,n)}}(n,this);const e=this,r=this._keyToRowNumber[t];this._data=ot(this._data,t=>{for(const o in n){Ne(o);const i=n[o];t[o][r]=i,e._resetDomainIfNecessary(o)}})},deleteRow(t){Se(t,this);const n=this,e=this._keyToRowNumber[t];delete this._keyToRowNumber[t],this._data=ot(this._data,t=>{for(const r in t)t[r].splice(e,1),n._resetDomainIfNecessary(r)})},addColumn(t,n){this._validateNewColumn(t,n),this._data=ot(this._data,e=>{e[t]=n})},replaceColumn(t,n){this.deleteColumn(t),this.addColumn(t,n)},deleteColumn(t){if($e(t,this),Ne(t),2===Object.keys(this._data).length)throw new Error("Cannot delete last column");this._data=ot(this._data,n=>{delete n[t]})},_updateDomainIfNecessary(t,n){const e=Fn(n);t in this._domains&&(this._domains[t]=In(this._domains[t],n,e))},_resetDomainIfNecessary(t){t in this._domains&&delete this._domains[t]},_validateNewColumn(t,n){if(ut(t),t in this._data)throw new Error(`Column '${t}' already exists`);if(Vn(this._data)!==n.length)throw new Error("Column must be of same length as rest of data");Pe(n)}};function Ne(t){if("$key"===t)throw new Error("Cannot modify key column")}function Ae(t,n,e){const r=t.data(),o=function(t){if(!(t instanceof Ie))throw new Error("It is only possible to join another DataContainer");return t.data()}(n);if(Cn(e)){const t=Vn(r);if(Vn(o)<t)throw new Error("Without 'by', the right DataContainer must be the same length as or longer than left DataContainer")}Sn(e)&&(function(t,n,e){if(e.constructor!==Array||2!==e.length||!e.every(t=>t.constructor===String))throw new Error("Invalid format of 'by'. Must be Array of two column names.");const[r,o]=e;if(!(r in t))throw new Error(`Column '${r}' not found`);if(!(o in n))throw new Error(`Column '${o}' not found`)}(r,o,e),function(t,n,e){const[r,o]=e,i=t[r],s=n[o],a=Rn(i),u=Rn(s);if(a!==u)throw new Error("'by' columns must be of the same type");(function(t){if(t.length!==new Set(t).size)throw new Error("Right 'by' column must contain only unique values")})(n[o]),function(t,n){const e=new Set(n);for(let n=0;n<t.length;n++){const r=t[n];if(!e.has(r))throw new Error("Left 'by' column must be subset of right column")}}(i,s)}(r,o,e),function(t,n,e){const r=e[1];for(const e in n)if("$key"!==e&&e in t&&e!==r)throw new Error(`Duplicate column name: '${e}'`)}(r,o,e))}class Ie{constructor(t,n={validate:!0}){if(this._data={},this._keyToRowNumber={},this._domains={},function(t){if(t.constructor===Object)return Object.keys(t).map(n=>t[n]).every(t=>t.constructor===Array);return!1}(t))this._setColumnData(t,n);else if(function(t){return t.constructor===Array&&t.every(t=>t.constructor===Object)}(t))this._setRowData(t,n);else if(function(t){const n="FeatureCollection"===t.type,e=t.features&&t.features.length>0;return n&&e}(t))this._setGeoJSON(t,n);else{if(!(t instanceof oe))throw Re;this._setGroup(t,n)}}data(){return this._data}row(t){const n=this._keyToRowNumber[t];return this._row(n)}prevRow(t){const n=this._keyToRowNumber[t]-1;return this._row(n)}nextRow(t){const n=this._keyToRowNumber[t]+1;return this._row(n)}rows(){const t=[],n=Vn(this._data);for(let e=0;e<n;e++)t.push(this._row(e));return t}column(t){return $e(t,this),this._data[t]}map(t,n){return this.column(t).map(n)}domain(t){if(t in this._domains)return this._domains[t];const n=$n(this.column(t),t);return this._domains[t]=n,n}type(t){return Rn(this.column(t))}columnNames(){return Object.keys(this._data)}hasColumn(t){return xe(t,this)}columnIsValid(t){return function(t,n){const e=Rn(t);return void 0!==e&&!!function(t,n){return!("$geometry"===t&&"geometry"!==n||"$geometry"!==t&&"geometry"===n)}(n,e)&&!!ke(t,e)}(this.column(t),t)}validateColumn(t){Pe(this.column(t),t)}validateAllColumns(){for(const t in this._data)this.validateColumn(t)}join(t,{by:n}={}){Ae(this,t,n);const e=function(t,n,e){const r=t.data(),o=n.data();if(Cn(e)){const t=Vn(r),n={};for(const e in o)if("$key"!==e){const r=o[e];n[e]=r.slice(0,t)}return n}if(Sn(e)){const t=function(t,n){const e={};for(const r in t)"$key"!==r&&r!==n&&(e[r]=[]);return e}(o,e[1]),n=function(t,n){const e={},r=t[n];for(let o=0;o<r.length;o++){const i=r[o],s={};for(const e in t)"$key"!==e&&e!==n&&(s[e]=t[e][o]);e[i]=s}return e}(o,e[1]),i=r[e[0]];for(let e=0;e<i.length;e++){const r=n[i[e]];for(const n in r)t[n].push(r[n])}return t}}(this,t,n);for(const t in e)this.addColumn(t,e[t])}_row(t){const n=Vn(this._data);if(t<0||t>=n)return;const e={};for(const n in this._data){const r=this._data[n][t];e[n]=r}return e}}var De;De=Ie,Object.assign(De.prototype,Gn),function(t){Object.assign(t.prototype,je)}(Ie),function(t){Object.assign(t.prototype,Me)}(Ie);const Re=new Error("Data passed to DataContainer is of unknown format");return Ie});